# 领域层

---

## 构成

* 实体：以唯一标识（如Id）区分，唯一标识不同，即便所有属性相同，也会被认为是不同的实体。
* 值对象：没有唯一标识，所有属性相同即可认为是同一个值对象。值对象是不可变类型。
* 聚合：多个实体和值对象组成的高度相关的一个业务包装，同时作为一个数据修改的最小单元。
* 领域服务：当一个用例横跨多个聚合时，由领域服务负责通过对聚合的编排组合完成用例。
* 领域事件：在一个业务场景中一个聚合内所发生的事件。领域事件是一种值类型。
* 仓储接口：用于定义聚合的持久化操作，只有聚合才有仓储。
* 基础设施接口：如仓储层接口、事件总线、消息推送等，业务系统的核心是领域层，其它层都是围绕着为领域层服务。领域层需要什么，就在基础设施接口定义什么，基础设施层则依赖领域层并实现其需要的接口。
* 工厂：为了保证聚合的原子性，当构建一个对象的过程很复杂，或者暴露过多的对象内部结构时，可以用工厂封装其构建过程便于调用方调用。

## 说明

* 实体与值对象的所有属性均为public get/protected set，它们只能通过自己的方法改变自己的状态。
* 聚合的原子性是DDD中第一原则，无论创建还是重建均要保证聚合的原子性。
* 领域服务不要相互调用从而形成网状调用链，业务逻辑的复用应该实现在聚合而不是领域服务，领域服务最主要的职责是编排调用聚合从而完成use case。
* 领域事件虽然是值类型，但也有Id用于基础设施的处理。
* 聚合A可以作为参数传递到聚合B内，但因为聚合间是独立的关系因此聚合B内不能调用聚合A的方法。
* 基础设施的设计方向与组件/工具类等相反，并不是组件/工具类有什么才提供什么封装，而是领域层中需要用到什么就直接定义基础设施接口，再由外界实现并通过接口注入。
* 工厂一般是静态类，**其返回的聚合必定是业务完整而无需再进行处理**的。